{% extends "base.html" %}

{% block title %}{{ member.nombre_masonico|default:member.nombre_completo }} | Directorio - {{ configuracion.nombre_sitio|default:'Logia Kukulkan #41' }}{% endblock %}

{% block meta_description %}Perfil de {{ member.nombre_masonico|default:member.nombre_completo }}, miembro de la Logia Kukulkan #41 en M√©rida, Yucat√°n. {{ member.grado_actual.nombre }} con {{ member.antiguedad_anios }} a√±os de trayectoria mas√≥nica.{% endblock %}

{% block content %}

<!-- Hero del perfil -->
<section class="relative bg-gradient-to-br from-borgo√±a/5 to-gold/5 dark:from-borgo√±a/10 dark:to-gold/10 py-16 md:py-24 overflow-hidden">
  <div class="absolute inset-0">
    <div class="absolute top-20 right-20 w-64 h-64 bg-gold/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 left-20 w-64 h-64 bg-borgo√±a/5 rounded-full blur-3xl"></div>
  </div>
  
  <div class="relative max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row items-center md:items-start gap-8 md:gap-12">
      
      <!-- Foto -->
      <div class="flex-shrink-0">
        <div class="relative">
          <div class="w-40 h-40 md:w-48 md:h-48 rounded-full bg-gradient-to-br from-gold/20 to-borgo√±a/20 flex items-center justify-center border-4 border-gold/30 shadow-2xl">
            {% if member.foto %}
              <img src="{{ member.foto.url }}" alt="{{ member.nombre_completo }}" class="w-full h-full rounded-full object-cover">
            {% else %}
              <span class="text-5xl md:text-6xl font-bold text-gold">
                {{ member.nombre_masonico|first|default:member.nombre_completo|first }}
              </span>
            {% endif %}
          </div>
          {% if member.cargo_actual %}
          <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-gold text-gray-900 rounded-full text-sm font-bold whitespace-nowrap shadow-lg">
            {{ member.cargo_actual.nombre }}
          </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Informaci√≥n -->
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-3">
          {{ member.nombre_masonico|default:member.nombre_completo }}
        </h1>
        
        {% if member.nombre_masonico %}
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-4">
          {{ member.nombre_completo }}
        </p>
        {% endif %}
        
        <div class="flex flex-wrap justify-center md:justify-start gap-3 mb-6">
          <span class="px-4 py-2 bg-gold/10 text-gold rounded-full text-sm font-medium border border-gold/20">
            {{ member.grado_actual.nombre }} ¬∑ {{ member.grado_actual.numero }}¬∞
          </span>
          <span class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">
            {{ member.antiguedad_anios }} a√±os en la Orden
          </span>
          <span class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">
            Iniciaci√≥n: {{ member.fecha_iniciacion|date:"d/m/Y" }}
          </span>
        </div>
        
        {% if member.email and member.es_publico %}
        <a href="mailto:{{ member.email }}" 
           class="inline-flex items-center gap-2 text-gold hover:text-gold/80 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          {{ member.email }}
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- Informaci√≥n detallada -->
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
  <div class="grid lg:grid-cols-3 gap-8">
    
    <!-- Columna principal -->
    <div class="lg:col-span-2 space-y-8">
      
      <!-- Biograf√≠a - Notas p√∫blicas -->
      {% if member.notas and member.es_publico %}
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
          <span class="w-10 h-10 bg-gold/10 rounded-lg flex items-center justify-center">
            <span class="text-gold text-xl">‚åñ</span>
          </span>
          Trayectoria mas√≥nica
        </h2>
        <div class="prose dark:prose-invert max-w-none">
          {{ member.notas|linebreaks }}
        </div>
      </div>
      {% endif %}
      
      <!-- Eventos hist√≥ricos relacionados -->
      {% if member.eventos_historicos.exists %}
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
          <span class="w-10 h-10 bg-gold/10 rounded-lg flex items-center justify-center">
            <span class="text-gold text-xl">üìú</span>
          </span>
          Eventos hist√≥ricos
        </h2>
        <div class="space-y-4">
          {% for evento in member.eventos_historicos.all|slice:":5" %}
          <div class="flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
            <span class="text-2xl text-gold/70">{{ evento.fecha|date:"Y" }}</span>
            <div>
              <h4 class="font-bold text-gray-900 dark:text-white">{{ evento.titulo }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400">{{ evento.descripcion_corta|default:evento.descripcion|truncatechars:100 }}</p>
              <a href="{% url 'historical_event' evento.id %}" class="text-xs text-gold hover:underline mt-2 inline-block">
                Ver evento ‚Üí
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
      
      <!-- Cursos tomados -->
      {% if user.is_authenticated and user.miembro.id == member.id %}
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
          <span class="w-10 h-10 bg-gold/10 rounded-lg flex items-center justify-center">
            <span class="text-gold text-xl">üìö</span>
          </span>
          Mis cursos
        </h2>
        {% if member.cursos_inscritos.exists %}
        <div class="space-y-3">
          {% for curso in member.cursos_inscritos.all %}
          <a href="{% url 'course_detail' curso.slug %}" class="block p-4 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gold/5 transition-colors">
            <div class="flex justify-between items-center">
              <div>
                <h4 class="font-bold text-gray-900 dark:text-white">{{ curso.titulo }}</h4>
                <span class="text-xs text-gray-500 dark:text-gray-500">{{ curso.get_grado_destinatario_display }}</span>
              </div>
              <span class="text-gold text-sm">Ver ‚Üí</span>
            </div>
          </a>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-600 dark:text-gray-400">No est√°s inscrito en ning√∫n curso actualmente.</p>
        {% endif %}
      </div>
      {% endif %}
    </div>
    
    <!-- Sidebar -->
    <div class="space-y-6">
      
      <!-- Informaci√≥n de contacto -->
      {% if member.es_publico %}
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          Contacto
        </h3>
        <div class="space-y-3 text-sm">
          {% if member.email %}
          <div class="flex items-center gap-3">
            <span class="text-gray-500 dark:text-gray-500 w-20">Email:</span>
            <a href="mailto:{{ member.email }}" class="text-gold hover:underline break-all">{{ member.email }}</a>
          </div>
          {% endif %}
          {% if member.telefono %}
          <div class="flex items-center gap-3">
            <span class="text-gray-500 dark:text-gray-500 w-20">Tel√©fono:</span>
            <a href="tel:{{ member.telefono }}" class="text-gray-700 dark:text-gray-300 hover:text-gold">{{ member.telefono }}</a>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
      
      <!-- Grados y fechas -->
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Informaci√≥n mas√≥nica
        </h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-500 dark:text-gray-500">Grado actual:</span>
            <span class="font-medium text-gray-900 dark:text-white">{{ member.grado_actual.nombre }} ({{ member.grado_actual.numero }}¬∞)</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500 dark:text-gray-500">Fecha de iniciaci√≥n:</span>
            <span class="text-gray-900 dark:text-white">{{ member.fecha_iniciacion|date:"d/m/Y" }}</span>
          </div>
          {% if member.fecha_ascenso %}
          <div class="flex justify-between">
            <span class="text-gray-500 dark:text-gray-500">√öltimo ascenso:</span>
            <span class="text-gray-900 dark:text-white">{{ member.fecha_ascenso|date:"d/m/Y" }}</span>
          </div>
          {% endif %}
          <div class="flex justify-between">
            <span class="text-gray-500 dark:text-gray-500">Antig√ºedad:</span>
            <span class="text-gray-900 dark:text-white">{{ member.antiguedad_anios }} a√±os</span>
          </div>
          {% if member.cargo_actual %}
          <div class="flex justify-between pt-3 mt-3 border-t border-gray-200 dark:border-gray-700">
            <span class="text-gray-500 dark:text-gray-500">Cargo actual:</span>
            <span class="font-bold text-gold">{{ member.cargo_actual.nombre }}</span>
          </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Firma (solo para miembros autenticados) -->
      {% if user.is_authenticated and user.miembro.id == member.id and member.firma %}
      <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Mi firma</h3>
        <img src="{{ member.firma.url }}" alt="Firma de {{ member.nombre_completo }}" class="max-h-20 mx-auto">
      </div>
      {% endif %}
      
      <!-- Bot√≥n de contacto -->
      {% if member.es_publico %}
      <a href="{% url 'directory' %}?asunto=contacto&miembro={{ member.id }}" 
         class="block w-full bg-gold hover:bg-gold/90 text-gray-900 font-bold py-4 px-6 rounded-xl text-center transition-all duration-300 hover:scale-105 hover:shadow-xl">
        Contactar Hermano
      </a>
      {% endif %}
      
      <!-- perfil del usuario autenticado -->
      {% if user.is_authenticated and user.miembro.id == member.id %}
      <div class="bg-gold/10 border border-gold/30 rounded-2xl p-6 text-center">
        <span class="text-3xl text-gold mb-3 block">‚à¥</span>
        <h4 class="font-bold text-gray-900 dark:text-white mb-2">Este es tu perfil</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
          Solo t√∫ puedes ver tu informaci√≥n de contacto y cursos.
        </p>
        <a href="{% url 'my_profile' %}" class="inline-flex items-center gap-2 text-gold hover:text-gold/80">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          Editar perfil
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Volver al directorio -->
<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 border-t border-gray-200 dark:border-gray-800">
  <a href="{% url 'directory' %}" class="inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gold transition-colors">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
    </svg>
    Volver al directorio de hermanos
  </a>
</section>
{% endblock %}